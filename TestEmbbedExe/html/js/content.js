(function(t){function e(e){for(var i,o,r=e[0],c=e[1],l=e[2],d=0,p=[];d<r.length;d++)o=r[d],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&p.push(s[o][0]),s[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);u&&u(e);while(p.length)p.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],i=!0,r=1;r<n.length;r++){var c=n[r];0!==s[c]&&(i=!1)}i&&(a.splice(e--,1),t=o(o.s=n[0]))}return t}var i={},s={content:0},a=[];function o(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=i,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var l=0;l<r.length;l++)e(r[l]);var u=c;a.push(["e6ce","chunk-vendors"]),n()})({"0a57":function(t,e,n){},"37bb":function(t,e,n){"use strict";var i=n("bf95"),s=n.n(i);s.a},"8ded":function(t,e,n){"use strict";var i=n("0a57"),s=n.n(i);s.a},bf95:function(t,e,n){},e6ce:function(t,e,n){"use strict";n.r(e);n("96cf");var i=n("1da1"),s=(n("0c67"),n("450d"),n("299c")),a=n.n(s),o=(n("06f1"),n("6ac9")),r=n.n(o),c=(n("cadf"),n("551c"),n("f751"),n("097d"),n("2b0e")),l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.show?n("el-popover",{attrs:{placement:"top-end",width:"328",trigger:"manual","popper-class":"xiaoyi-crx"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[n("div",{staticClass:"xiaoyi-crx__wrapper"},[n("div",{staticClass:"xiaoyi-crx__head"},[n("p",{staticClass:"xiaoyi-crx__head-title"},[t._v("\n        小一智能助手消息\n        "),t.count>0?n("span",[t._v("("+t._s(t.count)+")")]):t._e()]),n("div",[n("el-tooltip",{attrs:{content:"清除全部",placement:"top"}},[n("i",{staticClass:"iconfont iconqingchu xiaoyi-crx__head-icon icon-clear",on:{click:t.onClearAll}})]),n("i",{staticClass:"iconfont iconguanbi xiaoyi-crx__head-icon",on:{click:function(e){t.visible=!1}}})],1)]),n("div",{staticClass:"xiaoyi-crx__body"},[0===t.count?n("div",{staticClass:"xiaoyi-crx__empty"},[n("img",{staticClass:"xiaoyi-crx__empty-image",attrs:{src:"https://img-cdn.wezhuiyi.com/xiaoyi-bot-crx/empty.svg",alt:""}}),n("p",{staticClass:"xiaoyi-crx__empty-text"},[t._v("暂无消息")])]):n("div",{staticClass:"xiaoyi-crx__content"},t._l(t.list,(function(e,i){return n("div",{key:i,staticClass:"xiaoyi-crx__item",on:{click:function(n){return t.onSwitchUser(e.session,i)}}},[e.visible?n("div",{staticStyle:{"margin-bottom":"12px"}},["to_manual"===e.event?n("div",{staticClass:"bg-warning xiaoyi-crx__item-content"},[n("i",{staticClass:"iconfont iconjinggao-shixin xiaoyi-crx__item-icon"}),n("p",{staticClass:"xiaoyi-crx__item-text"},[t._v("\n                已拦截\n                "),n("span",{staticClass:"xiaoyi-crx__usernick"},[t._v(t._s(e.session.userNick))]),t._v("\n                系统转人工\n              ")]),n("i",{staticClass:"iconfont iconguanbi xiaoyi-crx__item-close",on:{click:function(e){return t.onClear(i)}}})]):t._e(),"send_text"===e.event?n("div",{staticClass:"bg-success xiaoyi-crx__item-content"},[n("i",{staticClass:"iconfont iconchenggong xiaoyi-crx__item-icon"}),n("p",{staticClass:"xiaoyi-crx__item-text"},[n("span",{staticClass:"xiaoyi-crx__usernick"},[t._v(t._s(e.session.userNick))]),t._v("\n                "+t._s(e.session.replyTime)+"分钟人工未处理，已兜底回复\n              ")]),n("i",{staticClass:"iconfont iconguanbi xiaoyi-crx__item-close",on:{click:function(e){return t.onClear(i)}}})]):t._e()]):t._e()])})),0)])]),n("div",{staticClass:"xiaoyi-crx__entry",style:t.style,attrs:{slot:"reference"},on:{mousedown:t.onMouseDown},slot:"reference"},[n("img",{staticClass:"xiaoyi-crx__logo",attrs:{src:"https://img-cdn.wezhuiyi.com/xiaoyi-bot/bot.png",alt:"",ondragstart:"return false;"}}),t.count>0?n("p",{staticClass:"xiaoyi-crx__badge"},[t._v("\n      "+t._s(t.count>=99?t.count+"+":t.count)+"\n    ")]):t._e()])]):t._e()},u=[],d={name:"App",data:function(){return{show:!1,visible:!1,list:[],initClientY:0,initTranslateY:0,translateY:0,initClientX:0,initTranslateX:0,translateX:0,dragging:!1,moveing:!1}},computed:{style:function(){return{transform:"translate(".concat(this.translateX,"px, ").concat(this.translateY,"px)")}},count:function(){return this.list.filter((function(t){return t.visible})).length}},watch:{list:{handler:function(t){var e=t.filter((function(t){return!(!1===t.visible&&(new Date).getTime()-t.session.time>6e4)}));window.localStorage.setItem("xiaoyiCrxMessages",JSON.stringify(e))},deep:!0}},mounted:function(){var t=this;window.addEventListener("message",(function(e){switch(e.data.type){case"sendZRG":t.list.push(Object.assign({},e.data.params,{visible:!0}));break;case"sendText":t.list.push(Object.assign({},e.data.params,{visible:!0}));break;case"getConfigCallback":t.show=!0;var n=window.localStorage.getItem("xiaoyiCrxMessages")||"[]";t.list=JSON.parse(n);break;default:break}}))},methods:{onSwitchUser:function(t,e){window.postMessage({model:"chromeCRX",type:"switchUser",session:t},"*"),this.onClear(e)},onClearAll:function(){this.list.map((function(t){return t.visible=!1}))},onClear:function(t){this.list[t].visible=!1},onMouseMove:function(t){if(this.moveing=!0,this.dragging){var e=128-document.documentElement.clientHeight,n=this.initTranslateY+t.clientY-this.initClientY;this.translateY=n>0?0:n<e?e:n;var i=128-document.documentElement.clientWidth,s=this.initTranslateX+t.clientX-this.initClientX;this.translateX=s>0?0:s<i?i:s}},onMouseDown:function(t){t.stopImmediatePropagation(),this.dragging=!0,document.addEventListener("mousemove",this.onMouseMove,!1),document.addEventListener("mouseup",this.onMouseUp,!1),this.initClientY=t.clientY,this.initClientX=t.clientX},onMouseUp:function(){!1===this.moveing&&(this.visible=!this.visible),this.moveing=!1,this.dragging=!1,this.initTranslateY=this.translateY,this.initTranslateX=this.translateX,document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),document.onselectstart=null}}},p=d,f=(n("37bb"),n("8ded"),n("2877")),m=Object(f["a"])(p,l,u,!1,null,"7c2f1da5",null),h=m.exports;n("ac6a");function v(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body";g(t,e)}function g(t,e){var n=y(t);x(e,n)}function x(t,e){var n=document.querySelectorAll(t);n.forEach((function(t){var n=document.createElement("div");n.id="insert-item",t.appendChild(n),e.$mount("#insert-item")}))}function y(t){var e=c["default"].extend(t);return new e}var _=v,b=n("2f62");c["default"].use(b["a"]);var w=new b["a"].Store({state:{},mutations:{},actions:{}}),C={beforeCreate:function(){this.$store=w}};n("fc72");function k(){document.addEventListener("readystatechange",(function(){var t="inject.js",e=document.createElement("script");e.setAttribute("type","text/javascript"),e.src=chrome.extension.getURL(t),document.body.appendChild(e)}))}function M(t){return fetch(t).then((function(t){return t.blob()}))}k(),c["default"].mixin(C),c["default"].use(r.a),c["default"].use(a.a),_(h),window.addEventListener("message",function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:"chromeCRX"===e.data.model&&chrome.runtime.sendMessage({type:e.data.type,params:e.data.params},function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(n){var i,s,a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("sendImage"!==e.data.type){t.next=12;break}return i=n.url,s=n.userId,t.next=5,M(i);case 5:a=t.sent,o=new File([a],encodeURIComponent(i),{type:a.type}),o.width=n.width,o.height=n.height,window.postMessage({type:"".concat(e.data.type,"Callback"),response:{file:o,userId:s}},"*"),t.next=13;break;case 12:window.postMessage({type:"".concat(e.data.type,"Callback"),response:n},"*");case 13:return t.abrupt("return",!0);case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),!1)},fc72:function(t,e,n){}});